Here are the essential knowledge takeaways for each critical chapter, tailored for a developer new to ComfyUI.

### 1. The Fundamentals

*   **`development/core-concepts/nodes.mdx`**
    *   **Nodes are Functions:** Every node is a discrete processing step with inputs and outputs.
    *   **Strict Typing:** Inputs and outputs are color-coded by data type (e.g., `IMAGE`, `LATENT`). You cannot connect mismatched types (like connecting an Image output to a Model input) without a conversion node.
    *   **States:** Nodes have distinct states: Normal, Running, Error, and Missing (if a custom node isn't installed).

*   **`development/core-concepts/workflow.mdx`**
    *   **Graph Structure:** A workflow is a Directed Acyclic Graph (DAG).
    *   **Portability:** Workflows can be saved as JSON files, but they are also automatically embedded into the metadata of any PNG generated by ComfyUI. Dragging an image into the UI loads the workflow that created it.

*   **`custom-nodes/overview.mdx`**
    *   **Client-Server Architecture:** ComfyUI is split into two distinct parts:
        1.  **Server (Python):** Handles heavy lifting, model loading, and PyTorch execution.
        2.  **Client (JavaScript):** Handles the UI, graph interaction, and widget rendering in the browser.
    *   **Node Types:** Most custom nodes are server-side only, but some require JS extensions to add custom UI widgets or interactivity.

### 2. Backend Development (Writing Custom Nodes)

*   **`custom-nodes/backend/server_overview.mdx`**
    *   **Class Structure:** A node is a Python class. It *must* define:
        *   `INPUT_TYPES`: A dictionary defining required/optional inputs and widgets.
        *   `RETURN_TYPES`: A tuple defining output types.
        *   `FUNCTION`: The string name of the method to execute.
        *   `CATEGORY`: Where it appears in the menu.
    *   **Return Tuple:** The execution function *must* return a tuple, even if there is only one output (e.g., `return (image_output,)`).

*   **`custom-nodes/backend/datatypes.mdx`**
    *   **Tensor Shapes:**
        *   `IMAGE`: Shape is `[Batch, Height, Width, Channels]` (Channels are usually 3 for RGB).
        *   `LATENT`: A dictionary containing a tensor `samples` with shape `[Batch, Channels, Height, Width]` (Channels are 4 for SD/Flux).
    *   **Custom Types:** You can define custom types (e.g., `BOUNDING_BOX`) by using a unique uppercase string in `INPUT_TYPES`.

*   **`custom-nodes/backend/tensors.mdx`**
    *   **Batch Dimension:** PyTorch tensors in Comfy always include a batch dimension. Even a single image is `[1, H, W, C]`.
    *   **Squeezing/Unsqueezing:** If you process a single image from a batch, you must use `.unsqueeze(0)` to add the batch dimension back before returning it, or downstream nodes will fail.

*   **`custom-nodes/v3_migration.mdx`**
    *   **The New Standard:** ComfyUI is moving away from the legacy `INPUT_TYPES` dict to a new V3 Schema using `define_schema` and `io.ComfyNode`.
    *   **Entrypoint:** Instead of mapping classes in `__init__.py`, V3 uses an async `comfy_entrypoint` function. New nodes should be written using this V3 syntax for future compatibility.

*   **`specs/nodedef_json.mdx`**
    *   **Validation:** The definition of nodes follows a strict JSON schema. This is primarily useful for understanding how the frontend validates your node definition to ensure it renders correctly.

### 3. Frontend Development (UI Extensions)

*   **`custom-nodes/js/javascript_overview.mdx`**
    *   **Registration:** To add client-side code, create a `js` folder in your node directory and export `WEB_DIRECTORY = "./js"` in your Python `__init__.py`.
    *   **Loading:** Scripts in this directory are automatically loaded by the browser when ComfyUI starts.

*   **`custom-nodes/js/javascript_hooks.mdx`**
    *   **Lifecycle:** You inject logic using `app.registerExtension`. Key hooks include:
        *   `beforeRegisterNodeDef`: Modify the prototype of a node class (affects all nodes of that type).
        *   `nodeCreated`: Modify a specific instance of a node when it is added to the canvas.
        *   `setup`: Run global setup code (e.g., adding event listeners) on startup.

*   **`custom-nodes/js/javascript_objects_and_hijacking.mdx`**
    *   **The App Object:** `app` is the main entry point. `app.graph` gives access to the underlying LiteGraph instance.
    *   **Widgets vs Inputs:** Widgets (UI controls) can often be converted to Inputs (slots) by the user. Your code needs to handle inputs coming from either source.

### 4. Integration & API

*   **`development/comfyui-server/comms_overview.mdx`**
    *   **Stateless API:** The server endpoint `/prompt` receives the *entire* workflow state. It does not "know" about the UI state until you send it.
    *   **Async:** The server uses `aiohttp` and `asyncio`.

*   **`development/comfyui-server/comms_routes.mdx`**
    *   **Key Endpoints:**
        *   `POST /prompt`: Submit a workflow for execution.
        *   `GET /history`: Check results of past executions.
        *   `GET /view`: Retrieve generated images.
        *   `POST /upload/image`: Upload images to be used by LoadImage nodes.

*   **`development/comfyui-server/comms_messages.mdx`**
    *   **WebSockets:** The server sends real-time updates via WebSocket (`/ws`).
    *   **Execution Tracking:** Listen for `execution_start` (job started), `executing` (reports which specific node ID is currently running), and `progress` (step progress bars).
    *   **Custom Messages:** You can send custom messages from Python to JS using `PromptServer.instance.send_sync("event_name", data)`.

*   **`interface/settings/comfy.mdx`**
    *   **Dev Mode:** You **must** enable "Enable dev mode options" in the ComfyUI settings (gear icon).
    *   **Save API Format:** This adds a "Save (API Format)" button to the menu. This saves the workflow in the specific JSON format required by the backend API (which uses node UIDs) rather than the format used by the UI (which uses visual layout data).

### 5. Distribution

*   **`registry/publishing.mdx`**
    *   **Publisher ID:** You must create a Publisher ID at registry.comfy.org to publish.
    *   **Comfy CLI:** Use `comfy node publish` to push your node. This is the modern way to get into the ComfyUI Manager list.

*   **`registry/specifications.mdx`**
    *   **pyproject.toml:** Your node metadata (name, version, dependencies) lives in `pyproject.toml`.
    *   **Semantic Versioning:** You must strictly adhere to semantic versioning (X.Y.Z) for the registry to accept updates.
